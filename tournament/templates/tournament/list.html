{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 py-8">

<a href="{% url 'tournament:create_tournament' %}"
   class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 inline-block inline-block mb-2">
  Tambah Turnamen
</a>

<p id="tournament-count" class="mt-3 text-gray-600 text-sm mb-6"></p>

<div class="flex gap-4 mb-16">
  <button class="bg-green-500 hover:bg-green-600 text-white font-medium px-3 py-1 rounded-xl"
          onclick="filterTournaments('public')">
    Turnamen Publik
  </button>

  {% if user.is_authenticated %}
  <button class="bg-blue-500 hover:bg-blue-600 text-white font-medium px-3 py-1 rounded-xl"
          onclick="filterTournaments('private')">
    Turnamen Privat Saya
  </button>
  {% else %}
  <button class="bg-gray-400 text-white font-medium px-3 py-1 rounded-xl opacity-50 cursor-not-allowed">
    Turnamen Privat Saya
  </button>
  {% endif %}
</div>


  <!-- Container kartu turnamen -->
  <div id="tournament-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  
</div>

{% load static %}

<script>
async function fetchTournaments(status = null) {
  let url = "{% url 'tournament:get_tournaments_json' %}";
  if (status) url += `?status=${status}`;
  const res = await fetch(url);
  const data = await res.json();

  const container = document.getElementById("tournament-list");
  container.innerHTML = "";

  data.forEach(item => {
  const detailUrl = `/tournament/${item.id}/`;

  const div = document.createElement("a");
  div.href = detailUrl;
  div.className = "block bg-white rounded-2xl shadow-md hover:shadow-xl transition overflow-hidden relative";

  const countText = document.getElementById("tournament-count");
  countText.textContent = `Menampilkan ${data.length} turnamen tersedia`;

  div.innerHTML = `
    <!-- Banner -->
    <div class="relative">
      <img src="${item.banner_image || 'https://via.placeholder.com/400x180'}"
           alt="${item.name}" class="w-full h-40 object-cover" />
      ${item.is_private
        ? `<span class="absolute top-2 right-2 bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded">Privat</span>`
        : `<span class="absolute top-2 right-2 bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded">Publik</span>`
      }
    </div>

    <!-- Body -->
    <div class="p-4">
      <h2 class="text-base font-bold mb-2 text-gray-800">${item.name}</h2>
      <div class="flex justify-between items-center mb-2">
        <p class="text-sm text-gray-500">
          ${new Date(item.start_date).toLocaleDateString('id-ID', { day: '2-digit', month: 'short' })}
        </p>
      </div>

      <!-- Info -->
      <div class="space-y-1 text-gray-600 text-sm">
        <div class="flex items-center gap-2">
          <img src="{% static 'tournament/icons/location.svg' %}" class="w-4 h-4" />
          <span>${item.location}</span>
        </div>
        <div class="flex items-center gap-2">
          <img src="{% static 'tournament/icons/team.svg' %}" class="w-4 h-4" />
          <span>${item.total_teams} Tim</span>
        </div>
        <div class="flex items-center gap-2">
          <img src="{% static 'tournament/icons/prize.svg' %}" class="w-4 h-4" />
          <span>${item.prize_pool || '-'}</span>
        </div>
      </div>
    </div>
  `;

  container.appendChild(div);
})
}

function filterTournaments(status) {
  fetchTournaments(status);
}

fetchTournaments();
</script>



</script>
{% endblock %}
