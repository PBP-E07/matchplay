{% extends 'base.html' %} 

{% load static %} 

{% block content %}
<main class="min-h-dvh w-full">
    <div class="relative h-[75dvh] overflow-hidden">
        <img
            class="absolute inset-0 w-full h-full object-cover z-10"
            src="{% static 'images/field.jpg' %}"
            alt="Banner"
        />
        <img
            class="opacity-20 absolute inset-0 w-full h-full object-cover z-20"
            src="{% static 'images/overlay.svg' %}"
            alt="Banner Overlay"
        />

        <div
            class="absolute inset-0 z-30 flex flex-col gap-8 items-center justify-center text-white mx-auto max-w-4xl"
        >
            <div class="flex flex-col gap-6 items-center justify-center">
                <p class="text-5xl font-bold">Find Your Venues, Match, Play.</p>

                <p class="text-xl">
                    Cari Lawan, Pesan Lapangan, Langsung Main.
                </p>
            </div>

            <div
                class="w-full bg-white rounded-2xl text-black flex w-full p-4 gap-4"
            >
                <div class="relative w-full">
                    <img
                        class="absolute left-3 inset-y-0 my-auto h-5 w-5 z-20"
                        src="{% static 'images/search.svg' %}"
                    />

                    <input
                        id="search-input"
                        class="duration-200 w-full h-12 bg-[#f3f3f5] rounded-xl pl-10 pr-4"
                        placeholder="Search matches, venues, sports"
                    />
                </div>

                <button
                    class="rounded-xl px-6 border flex gap-2 items-center justify-center"
                >
                    <img src="{% static 'images/funnel.svg' %}" />
                    Filters
                </button>

                <button
                    id="btn-search"
                    type="button"
                    class="rounded-xl px-6 bg-[#98DE5B] text-white flex items-center justify-center"
                >
                    Search
                </button>
            </div>
        </div>
    </div>

    <div class="w-full flex justify-center mt-8">
        <div class="flex bg-gray-100/90 rounded-full mx-auto shadow-md">
            <button
                id="btn-find-venues"
                class="flex items-center justify-center gap-2.5 px-6 py-2.5 rounded-full text-sm font-semibold duration-200"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    class="w-5 h-5"
                >
                    <path
                        fill-rule="evenodd"
                        d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 0 0 .281-.14c.186-.1.4-.223.615-.372a17.507 17.507 0 0 0 2.56-2.07C15.8 14.61 17 12.76 17 10c0-3.866-3.134-7-7-7S3 6.134 3 10c0 2.76 1.2 4.61 2.92 6.346a17.507 17.507 0 0 0 2.56 2.07c.215.149.43.272.615.372.094.05.18.09.282.14l.018.008.006.003zM10 11.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5z"
                        clip-rule="evenodd"
                    />
                </svg>
                Find Venues
            </button>

            <button
                id="btn-join-matches"
                class="flex items-center justify-center gap-2.5 px-6 py-2.5 rounded-full text-sm font-semibold duration-200"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    class="w-5 h-5"
                >
                    <path
                        d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.126-2.095a1.23 1.23 0 0 0 .41-1.412A9.99 9.99 0 0 0 10 12.01c-2.31 0-4.438.784-6.126 2.095Z"
                    />
                    <path
                        d="M16.707 12.293a1 1 0 0 1 0 1.414l-1 1a1 1 0 1 1-1.414-1.414l1-1a1 1 0 0 1 1.414 0Zm-13.414 0a1 1 0 0 0 0 1.414l1 1a1 1 0 0 0 1.414-1.414l-1-1a1 1 0 0 0-1.414 0Z"
                    />
                </svg>
                Join Matches
            </button>
        </div>
    </div>

    <div
        id="fields-container"
        class="w-full max-w-4xl mx-auto grid grid-cols-1 gap-6 mt-8" 
        >
        {% include 'partials/field_list_content.html' with page_obj=fields %}
    </div>

    <div id="matches-container" class="hidden w-full max-w-4xl mx-auto mt-6">
        <div class="col-span-3 bg-white p-6 rounded-lg shadow-md text-center">
            <p class="text-gray-600">
                Matches will be displayed here once the feature is ready.
            </p>
        </div>
    </div>
</main>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btnFindVenues = document.getElementById("btn-find-venues");
        const btnJoinMatches = document.getElementById("btn-join-matches");
        const fieldsContainer = document.getElementById("fields-container");
        const matchesContainer = document.getElementById("matches-container");
        const searchInput = document.getElementById("search-input");
        const searchButton = document.getElementById("btn-search");

        const activeClasses = ["bg-[#98DE5B]", "text-white"];
        const inactiveClasses = ["bg-transparent", "text-black"];

        function setView(view) {
            if (view === "venues") {
                btnFindVenues.classList.add(...activeClasses);
                btnFindVenues.classList.remove(...inactiveClasses);

                btnJoinMatches.classList.add(...inactiveClasses);
                btnJoinMatches.classList.remove(...activeClasses);

                fieldsContainer.classList.remove("hidden");
                matchesContainer.classList.add("hidden");
            } else if (view === "matches") {
                btnJoinMatches.classList.add(...activeClasses);
                btnJoinMatches.classList.remove(...inactiveClasses);
                btnFindVenues.classList.add(...inactiveClasses);
                btnFindVenues.classList.remove(...activeClasses);

                matchesContainer.classList.remove("hidden");
                fieldsContainer.classList.add("hidden");
            }
        }

        btnFindVenues.addEventListener("click", () => setView("venues"));
        btnJoinMatches.addEventListener("click", () => setView("matches"));

        searchButton.addEventListener("click", () => {
            const query = searchInput.value;

            if (!fieldsContainer.classList.contains("hidden")) {
                performSearch(query);
            } else {
                console.log("Search for matches (not implemented)");
            }
        });

        searchInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                searchButton.click();
            }
        });

        function performSearch(query) {
            fieldsContainer.innerHTML =
                '<p class="col-span-3 text-center text-gray-500">Loading...</p>';

            const url = `/search-fields/?q=${encodeURIComponent(query)}`;

            fetch(url)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.text();
                })
                .then((html) => {
                    fieldsContainer.innerHTML = html;
                })
                .catch((error) => {
                    console.error("Error fetching search results:", error);
                    fieldsContainer.innerHTML =
                        '<p class="col-span-3 text-center text-red-500">Error loading results.</p>';
                });
        }

        setView("venues");
    });
</script>
{% endblock content %}
