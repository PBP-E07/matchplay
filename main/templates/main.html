{% extends 'base.html' %} 

{% load static %} 

{% block content %}
<main class="min-h-dvh w-full">
    <div class="relative h-[75dvh] overflow-hidden">
        <img
            class="absolute inset-0 w-full h-full object-cover z-10"
            src="{% static 'images/field.jpg' %}"
            alt="Banner"
        />

        <img
            class="opacity-20 absolute inset-0 w-full h-full object-cover z-20"
            src="{% static 'images/overlay.svg' %}"
            alt="Banner Overlay"
        />

        <div
            class="absolute inset-0 z-30 flex flex-col gap-8 items-center justify-center text-white mx-auto max-w-4xl"
        >
            <div class="flex flex-col gap-6 items-center justify-center">
                <p class="text-5xl font-bold">Find Your Venues, Match, Play.</p>

                <p class="text-xl">
                    Cari Lawan, Pesan Lapangan, Langsung Main.
                </p>
            </div>

            <div
                class="w-full bg-white rounded-2xl text-black flex w-full p-4 gap-4"
            >
                <div class="relative w-full">
                    <img
                        class="absolute left-3 inset-y-0 my-auto h-5 w-5 z-20"
                        src="{% static 'images/search.svg' %}"
                    />

                    <input
                        id="search-input"
                        class="duration-200 w-full h-12 bg-[#f3f3f5] rounded-xl pl-10 pr-4"
                        placeholder="Search matches, venues, sports"
                    />
                </div>

                <button
                    class="rounded-xl px-6 border flex gap-2 items-center justify-center"
                >
                    <img src="{% static 'images/funnel.svg' %}" />

                    Filters
                </button>

                <button
                    id="btn-search"
                    type="button"
                    class="rounded-xl px-6 bg-[#98DE5B] text-white flex items-center justify-center"
                >
                    Search
                </button>
            </div>
        </div>
    </div>

    <div class="w-full flex justify-center mt-8">
        <div class="flex rounded-full mx-auto shadow-md">
            <button
                id="btn-find-venues"
                class="flex items-center justify-center gap-2.5 px-6 py-2.5 rounded-full text-sm font-semibold duration-200"
            >
                <img src="{% static 'images/location.svg' %}">    

                Find Venues
            </button>

            <button
                id="btn-join-matches"
                class="flex items-center justify-center gap-2.5 px-6 py-2.5 rounded-full text-sm font-semibold duration-200"
            >
                <img src="{% static 'images/people.svg' %}">

                Join Matches
            </button>
        </div>
    </div>

    <div
        id="fields-container"
        class="w-full max-w-4xl mx-auto grid grid-cols-1 gap-6 mt-8" 
        >
        {% include 'partials/field_list_content.html' with fields=fields %}
    </div>

    <div class="mb-12">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Available Matches</h2>
            <a href="{% url 'matches:show_matches' %}" class="text-green-600 hover:text-green-800 font-medium">View All &rarr;</a>
        </div>
        {% include 'partials/match_list_content.html' with matches=matches user=user %}
    </div>
</main>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btnFindVenues = document.getElementById("btn-find-venues");
        const btnJoinMatches = document.getElementById("btn-join-matches");
        const fieldsContainer = document.getElementById("fields-container");
        const matchesContainer = document.getElementById("matches-container");
        const searchInput = document.getElementById("search-input");
        const searchButton = document.getElementById("btn-search");

        const activeClasses = ["bg-[#98DE5B]", "text-white"];
        const inactiveClasses = ["bg-transparent", "text-black"];

        function setView(view) {
            if (view === "venues") {
                btnFindVenues.classList.add(...activeClasses);
                btnFindVenues.classList.remove(...inactiveClasses);

                btnJoinMatches.classList.add(...inactiveClasses);
                btnJoinMatches.classList.remove(...activeClasses);

                fieldsContainer.classList.remove("hidden");
                matchesContainer.classList.add("hidden");
            } else if (view === "matches") {
                btnJoinMatches.classList.add(...activeClasses);
                btnJoinMatches.classList.remove(...inactiveClasses);
                btnFindVenues.classList.add(...inactiveClasses);
                btnFindVenues.classList.remove(...activeClasses);

                matchesContainer.classList.remove("hidden");
                fieldsContainer.classList.add("hidden");
            }
        }

        btnFindVenues.addEventListener("click", () => setView("venues"));
        btnJoinMatches.addEventListener("click", () => setView("matches"));

        searchButton.addEventListener("click", () => {
            const query = searchInput.value;

            if (!fieldsContainer.classList.contains("hidden")) {
                performSearch(query);
            } else {
                console.log("Search for matches (not implemented)");
            }
        });

        searchInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                searchButton.click();
            }
        });

        function performSearch(query) {
            fieldsContainer.innerHTML =
                '<p class="col-span-3 text-center text-gray-500">Loading...</p>';

            const url = `/search_fields/?q=${encodeURIComponent(query)}`;

            fetch(url)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.text();
                })
                .then((html) => {
                    fieldsContainer.innerHTML = html;
                })
                .catch((error) => {
                    console.error("Error fetching search results:", error);
                    fieldsContainer.innerHTML =
                        '<p class="col-span-3 text-center text-red-500">Error loading results.</p>';
                });
        }

        setView("venues");
    });
</script>
{% endblock content %}
